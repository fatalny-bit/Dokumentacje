Internet
   │
[Publiczny adres IP / NAT]
   │
[Router Hitron]
   │  (port forwarding UDP 51820 → RedHat)
   │
[RedHat host]
   │
[Kontener WireGuard]
   │
[Twoja sieć domowa LAN]



sudo mkdir -p /opt/wireguard/config
sudo chown -R 1000:1000 /opt/wireguard
sudo chmod 700 /opt/wireguard/config

pozwoli uruchmić kontener bez sudo



podman run -d \
  --name=wireguard \
  --cap-add=NET_ADMIN \
  --cap-add=SYS_MODULE \
  -e PUID=1000 \
  -e PGID=1000 \
  -e TZ="Europe/Warsaw" \
  -e SERVERURL="zewnetrzny adres IP" \
  -e SERVERPORT=51820 \
  -e PEERS=1 \less
  -e PEERDNS=192.168.0.6 \
  -e INTERNAL_SUBNET=10.13.13.0/24 \
  -p 51820:51820/udp \
  -v /opt/wireguard/config:/config \
  --sysctl="net.ipv4.conf.all.src_valid_mark=1" \
  --restart unless-stopped \
  lscr.io/linuxserver/wireguard:latest

Właczenie routingu na hoscie

sudo sysctl -w net.ipv4.ip_forward=1


a na stałe:
echo "net.ipv4.ip_forward = 1" | sudo tee -a /etc/sysctl.conf


WYłączenie blokowania portu przez SElinux

sudo semanage port -a -t container_port_t -p udp 51820


WireGuard sam robi NAT, ale tylko jeśli host pozwala na iptables.

Na RHEL z firewalld może być potrzebne:

sudo firewall-cmd --add-masquerade --permanent
sudo firewall-cmd --reload



sudo mkdir -p /opt/wireguard/config
sudo chown -R 1000:1000 /opt/wireguard
sudo chmod 700 /opt/wireguard/config

docker run -d \
  --name=wireguard \
  --cap-add=NET_ADMIN \
  --cap-add=SYS_MODULE \
  -e PUID=1000 \
  -e PGID=1000 \
  -e TZ="Europe/Warsaw" \
  -e SERVERURL="zewnetrzny adres IP" \
  -e SERVERPORT=51820 \
  -e PEERS=1 \
  -e PEERDNS=192.168.0.6 \
  -e INTERNAL_SUBNET=10.13.13.0/24 \
  -p 51820:51820/udp \
  -v /opt/wireguard/config:/config \
  --sysctl="net.ipv4.conf.all.src_valid_mark=1" \
  --restart unless-stopped \
  lscr.io/linuxserver/wireguard:latest
  
sudo sysctl -w net.ipv4.ip_forward=1


sudo iptables -t nat -A POSTROUTING -s 10.13.13.0/24 -o enp3s0 -j MASQUERADE
sudo iptables -A FORWARD -i enp3s0 -o wg0 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i wg0 -o enp3s0 -j ACCEPT


sudo ufw allow 51820/udp (jeśli ufw jest aktywne)
