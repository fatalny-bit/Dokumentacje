Ingress
1. NGINX Ingress Controller

# kubectl get pods -n ingress-nginx

Jeśli nie istnieje

# kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml



# kubectl get pods -n ingress-nginx
NAME                                        READY   STATUS    RESTARTS   AGE
ingress-nginx-controller-59bc454dc9-7lf28   1/1     Running   0          44s


2. zmieniamy w manifescie aplikacji noeport na ingress

w web.yaml zamieniamy sekcję

apiVersion: v1
kind: Service
metadata:
  name: web
spec:
  type: NodePort
  selector:
    app: web
  ports:
  - port: 80
    nodePort: 30080

Na 

apiVersion: v1
kind: Service
metadata:
  name: web
  namespace: webapp-ns
spec:
  selector:
    app: web
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP


i stosujemy manifest web.yaml
# kubectl apply -f web.yaml

To tworzy Service typu ClusterIP dla aplikacji web

3. Tworzymy Ingress resources

ingress.yaml

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: webapp-ingress
  namespace: webapp-ns
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx
  rules:
  - host: webapp.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: web
            port:
              number: 80
